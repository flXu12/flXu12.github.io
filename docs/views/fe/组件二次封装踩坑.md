---
title: 【踩坑】组件二次封装指北
date: 2021-05-16
categories:
 - 前端
tags:
 - JavaScript
sidebar: auto
---  

> 这是一篇拖了很久的文章，原本打算写在【day-day-up系列】里的，想了想还是详细点，单独开个page吧~

## 1. 背景说明
事情的起因是这样的：  
  xx产品：我想要咱们系统里边所有的下拉框都支持拖拽！  
  我：这个需求是为了解决啥问题？  
  xx产品：销售跟我反馈的，因为他在xx系统看到过这样的实现，当下拉框数据量很大时，可能横、纵向会存在滚动条，但我希望能多看到一些数据，不想看到滚动条  
  我：滚动条就是为了更好地展示大数据呀，不然下拉框变得很大不是影响视觉效果么？  
  xx产品：你说得对，所以我觉得可以让用户自己拖拽，想看多少看多少  
  我：咱可以把下拉框的默认宽高稍微调整下不就好了， 干嘛要这么复杂？  
  xx产品：咱们系统里的数据比较复杂，写死宽高肯定无法满足所有场景的，我就想让它支持拖拽！而且现在已经有实现好的系统了，你照着做不就好了嘛  
  我：。。。  
  xx产品：而且对于下拉树，如果是多选然后又想一次性看到整棵子树的勾选情况，你说的那种方案也不行嘛  
  我：哪几种下拉框需要支持？  
  xx产品：select和treeSelect  

由于组件库是参考了`element UI`自研的，我们在项目中都是使用组件库提供的`select`和`tree-select`组件。然后，我找到了组件库开发团队，并向他们提出了我的诉求：  
  我：以上就是这个需求的背景，请问你们这边能支持吗？  
  组件库研发：这个需要评审一下才行，评审通过才能做，咱们先表决下个人意见吧！  
  组件库UED：我反对，因为这个只在你们这个产品提了需求，咱们组件库是服务整个公司所有产线的，需要考虑通用性，我个人认为这个需求所述方案并不通用  
  组件库研发：我反对，因为现在业界的组件库都没有这种能力，也许你可以跟产品再battle一下~  
  我：如果battle有用的话，我找你们干啥？产品表示这是个强需求，提到P0啦  
  组件库UED：那这样吧，我建议是你先自己实现一版，我这边持续收集其他产线的情况，后边如果在其他产线也有这种问题，咱们再考虑由组件库来支持  
  我：那组件库研发你这边，能给我一些开发建议么？select和tree-select组件是全局注册组件，期望以最低的修改成本实现resize的能力  
  组件库研发：可以重新注册select和tree-select组件，覆盖一下就好了  
  我：好的，我研究下  

就这样，中间反复拉着产品和组件库研发团队沟通数次无果，只能自己基于现有组件库二次封装`select`和`tree-select`，然后重新注册这俩组件使全局生效。  
最终实现效果：  
[WIP] 贴图

## 2. 如何实现拖拽？
关于拖拽的实现走了一些弯路，基础不扎实。  
一开始就朝着第三方库的方向走了，以为拖拽能力是需要被封装才能直接使用的，因此去调研了[vue-draggable-resizable](https://github.com/mauricius/vue-draggable-resizable)、[vue-moveable](https://github.com/daybrush/moveable/tree/master/packages/vue-moveable)、[jquery-ui](https://github.com/jquery/jquery-ui)这三个库。  
虽然都能实现我想要的拖拽功能，但或多或少都存在一些问题：包体积大、不支持Vue3、需要定制组件等等。  
后来才发现CSS是有一个现成的属性`resize`专门用于控制元素的可调整大小性：[CSS-resize](https://developer.mozilla.org/zh-CN/docs/Web/CSS/resize)。  
**最终实现：**    
在`select`和`tree-select`组件的`popover`元素上添加如下样式：  
```css
.select.popover,
.tree-select.popover {
  resize: both; // 垂直水平方向均可支持拖拽
  overflow: auto; // 滚动条自动
}
```

## 3. 为什么需要二次封装？
直接给下拉框元素添加`resize: both`是可以支持拖拽的，但是拖着拖着发现一个新的问题：[WIP] 贴图

原来是下拉内容区设置了最小高度，这个高度是通过tree-select组件的一个内置属性通过监听props计算得到的。



