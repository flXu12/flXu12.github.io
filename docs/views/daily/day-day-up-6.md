---
title: 【day day up系列】2021年12月学习笔记
date: 2021-12-09
categories:
 - 日常
tags:
 - daily
siderbar: auto
---

> 总有一天你会知道，任何想要但觉得遥远的东西，努力的话是能碰得着的。

## 1. vue router history刷新404
最近在gitlab上创建了一个用于管理各种需规和设计资源的项目（技术背景：Vue3 + vue-router4 + ant Design Vue2），并使用gitlab pages进行了部署，但是在使用过程中发现了一个问题：通过router.push跳转不同路由页面是OK的；但对路由页面进行刷新时，页面404了。  
![](../images/daily-019.png)  
从network请求来看，浏览器试图向服务器请求一个index文件，但服务器不存在此资源，就返回了默认的404页面。  
那么就联想到如下问题：   
- 是所有页面刷新都会404吗？   
- 为什么通过路由跳转页面OK，但浏览器刷新页面就404呢？  

**所有页面刷新都会404吗？**  
首先我们来对页面进行一个分类：第一种是路由页面，第二种是静态资源页面。这两种页面分别有如下特点：  
路由页面： 由于是单页应用，只有一个入口，从构建制品来看，所有页面资源均在一个html文件中，通过路由进行动态加载，因此在切换路由时，**不会向服务器发起任何请求**。  
静态资源页面： 有自己的html文件，通过浏览器url访问时，**会向服务器发起请求**，用于获取该页面对应的html,js,css等资源。  

根据这两种页面的特点，可以得出如下结论：  
通过router动态切换路由(push, replace等)时，**不会向服务器发起请求**，页面正常展示；    
访问静态资源页面时，**会向服务器发起请求**， 服务器上存在该资源，所以无论刷新与否，都能正常展示。

**为什么通过路由跳转页面OK，但浏览器刷新页面就404呢？**  
通过动态路由来切换页面，其实就是通过js操作dom，从而让用户看到不同的页面效果，但实际在控制台network上可以看到，浏览器并没有向服务器发起任何资源请求。原因是上述页面所需的html，js，css等资源在第一次访问首页时就已经被加载过。  
在切换路由时，用户以为是打开了一个新的html页面，但实际还是使用的 html；同样的，虽然浏览器的url发生了变化，但其实是使用了浏览器的[History.pushState()](https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState)，可以实现不刷新页面的同时更改URL。  
再来说页面404可能就比较好理解了，我们刷新页面时，会向服务器发起请求，请求的内容就是根据当前浏览器的url去请求服务器对应路径上的资源，但由于我们的入口文件只有一个并且该路径与请求的url不匹配，服务器匹配不上正确的html，就会甩一个404页面出来。  

**怎么解决页面刷新404？**  
修改nginx配置，当请求的资源不存在时，将原本默认的404请求指向入口文件，也就是项目配置的baseurl对应的资源。  
![](../images/daily-020.png)